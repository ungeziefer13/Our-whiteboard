<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="google-site-verification" content="LQ9vdR1iNToKL1Gp4PhzHHlNh578ApPndzqx_nH0HXU" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Free online whiteboard with real-time sync across devices via Room Code. No installation needed.">
    <title>Global TimeWhiteboard</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
        
        body { margin: 0; padding: 0; font-family: 'Pretendard', sans-serif; background-color: #f4f6f8; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        /* ë¡œê·¸ì¸(ë°© ì…ë ¥) ì˜¤ë²„ë ˆì´ */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.98); z-index: 9999;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .login-box {
            background: white; padding: 40px; border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1); text-align: center;
            max-width: 400px; width: 90%; border: 1px solid #eee;
        }
        .login-box h1 { margin-top: 0; color: #3b82f6; }
        .login-box input {
            width: 100%; padding: 15px; margin: 15px 0; border: 2px solid #eee;
            border-radius: 10px; font-size: 16px; box-sizing: border-box; outline: none; transition: 0.3s;
        }
        .login-box input:focus { border-color: #3b82f6; }
        .login-box button {
            width: 100%; padding: 15px; background: #3b82f6; color: white;
            border: none; border-radius: 10px; font-size: 16px; font-weight: bold; cursor: pointer;
        }
        .login-box button:hover { background: #2563eb; }

        /* [ê´‘ê³  ì˜ì—­] ìƒë‹¨ í—¤ë” ë° ë°°ë„ˆ */
        header { 
            background: white; padding: 0 20px; border-bottom: 1px solid #ddd; 
            display: flex; justify-content: space-between; align-items: center; 
            height: 70px; flex-shrink: 0; 
        }
        .header-left { display: flex; align-items: center; gap: 20px; }
        .logo { font-weight: 800; font-size: 20px; color: #3b82f6; }
        .room-badge { font-size: 13px; background: #eef2ff; color: #3b82f6; padding: 4px 8px; border-radius: 4px; font-weight: 600; display: none; }
        
        .ad-slot-top {
            width: 468px; height: 50px; 
            background: #f1f3f5; color: #adb5bd; 
            display: flex; align-items: center; justify-content: center; font-size: 12px;
            border-radius: 4px;
        }

        /* ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        #main-container { flex-grow: 1; position: relative; overflow: hidden; display: flex; }
        #canvas-wrapper { flex-grow: 1; position: relative; background: #fff; cursor: crosshair; }
        
        /* [ê´‘ê³  ë° ì •ë³´ ì˜ì—­] ìš°ì¸¡ ì‚¬ì´ë“œë°” */
        aside { 
            width: 320px; background: #fff; border-left: 1px solid #e5e7eb; 
            padding: 20px; display: flex; flex-direction: column; gap: 20px; 
            flex-shrink: 0; overflow-y: auto; z-index: 5;
        }
        .ad-slot-sidebar {
            width: 100%; height: 250px; background: #f1f3f5; color: #adb5bd;
            display: flex; align-items: center; justify-content: center; font-size: 12px; border-radius: 8px;
        }
        
        @media (max-width: 900px) { 
            .ad-slot-top { display: none; } 
            aside { display: none; } 
        }

        /* í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        h2 { font-size: 16px; margin: 0 0 10px 0; color: #111; }
        p, li { font-size: 14px; color: #555; line-height: 1.6; margin-bottom: 5px; }
        ul { padding-left: 20px; margin: 0; }
        .footer-link { margin-top: auto; font-size: 12px; color: #999; text-align: center; padding-top: 20px; }
        .footer-link a { color: #666; text-decoration: none; }

        /* íˆ´ë°” & UI */
        #toolbar { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); background: white; padding: 8px 16px; border-radius: 50px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); display: flex; gap: 15px; align-items: center; z-index: 10; }
        #timeMachine { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 600px; background: rgba(255, 255, 255, 0.95); padding: 10px 20px; border-radius: 12px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 5px; z-index: 10; }
        
        input[type="color"], input[type="range"] { cursor: pointer; }
        button.tool-btn { background: #fff; border: 1px solid #ddd; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 13px; font-family: inherit;}
        button.tool-btn:hover { background: #f8f9fa; }
        button.tool-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
        
        select#langSelector { padding: 5px; border-radius: 4px; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <h1>TimeWhiteboard</h1>
            <p data-i18n="login_desc">Enter a Room Code to join.</p>
            <input type="text" id="roomCodeInput" placeholder="Ex: meeting-1, class-a..." autocomplete="off">
            <button onclick="joinRoom()" data-i18n="join_btn">Join Room</button>
        </div>
    </div>

    <header>
        <div class="header-left">
            <div class="logo">TimeWhiteboard</div>
            <div id="roomBadge" class="room-badge"></div>
            <select id="langSelector">
                <option value="en">ğŸ‡ºğŸ‡¸ English</option>
                <option value="ko">ğŸ‡°ğŸ‡· í•œêµ­ì–´</option>
                <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
            </select>
        </div>
        <div class="ad-slot-top" data-i18n="ad_top">Ad Space (Top Banner)</div>
    </header>

    <div id="main-container">
        <div id="canvas-wrapper">
            <div id="toolbar">
                <input type="color" id="colorPicker" value="#1a1a1a">
                <input type="range" id="lineWidth" min="2" max="50" value="4">
                <button class="tool-btn active" id="penBtn" data-i18n="pen">Pen</button>
                <button class="tool-btn" id="eraserBtn" data-i18n="eraser">Eraser</button>
            </div>
            <canvas id="whiteboard"></canvas>
            <div id="timeMachine">
                <div style="display:flex; justify-content:space-between; margin-bottom:5px;">
                    <button class="tool-btn" id="playBtn" data-i18n="play">â–¶ Play</button>
                    <span id="statusText" style="font-size:12px; color:#666;">History: 0 / 0</span>
                </div>
                <input type="range" id="historySlider" min="0" max="0" value="0" style="width:100%;">
            </div>
        </div>

        <aside>
            <div class="ad-slot-sidebar" data-i18n="ad_side">Ad Space (Sidebar)</div>
            
            <article>
                <h2 data-i18n="guide_title">User Guide</h2>
                <p data-i18n="guide_desc">Draw and share ideas instantly without installation. Use the 'Time Machine' feature to replay your creative process.</p>
            </article>

            <article>
                <h2 data-i18n="features_title">Key Features</h2>
                <ul>
                    <li data-i18n="feature_1"><strong>Real-time Sync:</strong> Drawings are synced across all devices via Room Code.</li>
                    <li data-i18n="feature_2"><strong>Time Travel:</strong> Press Play to rewind and watch the drawing process.</li>
                    <li data-i18n="feature_3"><strong>Auto Cleanup:</strong> Data is cleared when the room becomes empty.</li>
                </ul>
            </article>

            <div class="footer-link">
                <a href="privacy.html" data-i18n="privacy">Privacy Policy</a>
                <br>Â© 2026 TimeWhiteboard
            </div>
        </aside>
    </div>

    <script>
        // =========================================================
        // ğŸ”¥ [ì„¤ì • ì™„ë£Œ] Firebase Config ğŸ”¥
        // =========================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCE3h0H-TW4KVQtF9E0_RW6nhCO6ydpHYs",
            authDomain: "lezgoooo.firebaseapp.com",
            projectId: "lezgoooo",
            storageBucket: "lezgoooo.firebasestorage.app",
            messagingSenderId: "665618240705",
            appId: "1:665618240705:web:66f4c95e95dd4e85223040",
            databaseURL: "https://lezgoooo-default-rtdb.firebaseio.com"
        };
        // =========================================================

        // Firebase ì´ˆê¸°í™”
        let db, roomRef, userRef;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database();
            console.log("Firebase initialized");
        } catch(e) {
            console.error("Firebase Init Error:", e);
        }

        // ì „ì—­ ë³€ìˆ˜
        let currentRoom = "";
        let drawHistory = [];
        let isReplaying = false;
        let isDrawing = false;
        let lastX = 0, lastY = 0;
        let isEraserMode = false;
        let currentLang = 'en';
        
        // ìœ ì € ì‹ë³„ìš© ëœë¤ ID ìƒì„± (ì„¸ì…˜ë³„ ê³ ìœ )
        const myUserId = 'user_' + Math.random().toString(36).substr(2, 9);

        // DOM ìš”ì†Œ
        const canvas = document.getElementById('whiteboard');
        const ctx = canvas.getContext('2d');
        const wrapper = document.getElementById('canvas-wrapper');
        const historySlider = document.getElementById('historySlider');
        const statusText = document.getElementById('statusText');
        const overlay = document.getElementById('loginOverlay');
        const roomInput = document.getElementById('roomCodeInput');
        const roomBadge = document.getElementById('roomBadge');
        const playBtn = document.getElementById('playBtn');
        const penBtn = document.getElementById('penBtn');
        const eraserBtn = document.getElementById('eraserBtn');

        // --- ë‹¤êµ­ì–´ (i18n) ì„¤ì • ---
        const translations = {
            en: {
                login_desc: "Enter a Room Code to join.",
                join_btn: "Join Room",
                ad_top: "Ad Space (Top Banner)",
                ad_side: "Ad Space (Sidebar)",
                pen: "Pen", eraser: "Eraser", play: "â–¶ Play", stop: "â¹ Stop",
                history: "History", replaying: "Replaying...",
                guide_title: "User Guide",
                guide_desc: "Draw and share ideas instantly without installation. Use the 'Time Machine' feature to replay your creative process.",
                features_title: "Key Features",
                feature_1: "<strong>Real-time Sync:</strong> Drawings are synced across all devices via Room Code.",
                feature_2: "<strong>Time Travel:</strong> Press Play to rewind and watch the drawing process.",
                feature_3: "<strong>Auto Cleanup:</strong> Data is cleared when the room becomes empty.",
                privacy: "Privacy Policy"
            },
            ko: {
                login_desc: "ì°¸ì—¬í•  ë°© ì½”ë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.",
                join_btn: "ì…ì¥í•˜ê¸°",
                ad_top: "ìƒë‹¨ ë°°ë„ˆ ê´‘ê³  ì˜ì—­",
                ad_side: "ì‚¬ì´ë“œë°” ê´‘ê³  ì˜ì—­",
                pen: "íœ", eraser: "ì§€ìš°ê°œ", play: "â–¶ ì¬ìƒ", stop: "â¹ ì •ì§€",
                history: "íˆìŠ¤í† ë¦¬", replaying: "ì¬ìƒ ì¤‘...",
                guide_title: "ì´ìš© ì•ˆë‚´",
                guide_desc: "ì„¤ì¹˜ ì—†ì´ ì¦‰ì‹œ ê·¸ë¦¼ì„ ê·¸ë¦¬ê³  ê³µìœ í•˜ì„¸ìš”. 'íƒ€ì„ë¨¸ì‹ ' ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ ì•„ì´ë””ì–´ ì „ê°œ ê³¼ì •ì„ ë˜ê°ì•„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
                features_title: "ì£¼ìš” ê¸°ëŠ¥",
                feature_1: "<strong>ì‹¤ì‹œê°„ ë™ê¸°í™”:</strong> ë°© ì½”ë“œë§Œ ê°™ìœ¼ë©´ PC, íƒœë¸”ë¦¿ ì–´ë””ì„œë“  ê·¸ë¦¼ì´ ê³µìœ ë©ë‹ˆë‹¤.",
                feature_2: "<strong>íƒ€ì„ë¨¸ì‹ :</strong> ì¬ìƒ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì²˜ìŒë¶€í„° ê·¸ë ¤ì§€ëŠ” ê³¼ì •ì„ í™•ì¸í•˜ì„¸ìš”.",
                feature_3: "<strong>ìë™ ì²­ì†Œ:</strong> ë§ˆì§€ë§‰ ì‚¬ëŒì´ ë‚˜ê°€ë©´ ë°© ë°ì´í„°ëŠ” ìë™ìœ¼ë¡œ ì´ˆê¸°í™”ë©ë‹ˆë‹¤.",
                privacy: "ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨"
            },
            ja: {
                login_desc: "å‚åŠ ã™ã‚‹ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
                join_btn: "å‚åŠ ã™ã‚‹",
                ad_top: "åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹ (ä¸Šéƒ¨)",
                ad_side: "åºƒå‘Šã‚¹ãƒšãƒ¼ã‚¹ (ã‚µã‚¤ãƒ‰ãƒãƒ¼)",
                pen: "ãƒšãƒ³", eraser: "æ¶ˆã—ã‚´ãƒ ", play: "â–¶ å†ç”Ÿ", stop: "â¹ åœæ­¢",
                history: "å±¥æ­´", replaying: "å†ç”Ÿä¸­...",
                guide_title: "åˆ©ç”¨ã‚¬ã‚¤ãƒ‰",
                guide_desc: "ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦ã§ã™ãã«æç”»ãƒ»å…±æœ‰ã§ãã¾ã™ã€‚ã€Œã‚¿ã‚¤ãƒ ãƒã‚·ãƒ³ã€æ©Ÿèƒ½ã§ã‚¢ã‚¤ãƒ‡ã‚¢ã®éç¨‹ã‚’å†ç”Ÿã§ãã¾ã™ã€‚",
                features_title: "ä¸»ãªæ©Ÿèƒ½",
                feature_1: "<strong>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸ:</strong> ãƒ«ãƒ¼ãƒ ã‚³ãƒ¼ãƒ‰ã§å…¨ã¦ã®ãƒ‡ãƒã‚¤ã‚¹ã¨åŒæœŸã—ã¾ã™ã€‚",
                feature_2: "<strong>ã‚¿ã‚¤ãƒ ãƒã‚·ãƒ³:</strong> å†ç”Ÿãƒœã‚¿ãƒ³ã§æç”»ãƒ—ãƒ­ã‚»ã‚¹ã‚’æŒ¯ã‚Šè¿”ã‚Œã¾ã™ã€‚",
                feature_3: "<strong>è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—:</strong> å…¨å“¡ãŒé€€å‡ºã™ã‚‹ã¨ãƒ‡ãƒ¼ã‚¿ã¯å‰Šé™¤ã•ã‚Œã¾ã™ã€‚",
                privacy: "ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼"
            }
        };

        function updateLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) el.innerHTML = translations[lang][key];
            });
            playBtn.innerHTML = isReplaying ? translations[lang].stop : translations[lang].play;
            updateSliderUI();
        }

        document.getElementById('langSelector').addEventListener('change', (e) => updateLanguage(e.target.value));

        // --- [í•µì‹¬] ë°© ì…ì¥ ë° ë°ì´í„° ìë™ ê´€ë¦¬ ë¡œì§ ---
        function joinRoom() {
            const code = roomInput.value.trim();
            if (!code) return alert("Please enter a room code.");
            
            currentRoom = code;
            overlay.style.display = 'none';
            roomBadge.style.display = 'block';
            roomBadge.innerText = `ROOM: ${currentRoom}`;
            
            resizeCanvas();

            // DB ì°¸ì¡° ê²½ë¡œ ì„¤ì •
            roomRef = db.ref('rooms/' + currentRoom);
            const usersRef = roomRef.child('users');

            // 1. ì…ì¥ ì‹œì : í˜„ì¬ ë°©ì— ì‚¬ëŒì´ ìˆëŠ”ì§€ í™•ì¸ (í•œ ë²ˆë§Œ ì‹¤í–‰)
            usersRef.once('value', (snapshot) => {
                const hasUsers = snapshot.exists() && snapshot.numChildren() > 0;
                
                if (!hasUsers) {
                    // ì‚¬ëŒì´ ì—†ìœ¼ë©´ 'ë²„ë ¤ì§„ ë°©' -> ë°ì´í„°(ê·¸ë¦¼) ì‚­ì œ í›„ ì‹œì‘
                    console.log("Empty room detected. Clearing previous data...");
                    roomRef.child('strokes').remove(); 
                } else {
                    console.log("Room is active. Loading existing data...");
                }

                // 2. ë‚˜ë¥¼ 'ì ‘ì† ì¤‘ì¸ ìœ ì €' ëª…ë‹¨ì— ë“±ë¡
                userRef = usersRef.child(myUserId);
                userRef.set(true);
                
                // 3. ì ‘ì† ëŠê¸°ë©´(íƒ­ ë‹«ê¸°, ìƒˆë¡œê³ ì¹¨) ìë™ìœ¼ë¡œ ëª…ë‹¨ì—ì„œ ì‚­ì œ
                userRef.onDisconnect().remove();

                // 4. ê·¸ë¦¼ ë°ì´í„° êµ¬ë… ì‹œì‘
                subscribeToDrawings();
            });
        }

        function subscribeToDrawings() {
            // ê·¸ë¦¼ ì¶”ê°€ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            roomRef.child('strokes').on('child_added', (snapshot) => {
                const stroke = snapshot.val();
                drawHistory.push(stroke);
                
                if (!isReplaying) {
                    drawLine(stroke.start, stroke.end, stroke.color, stroke.width, stroke.isEraser);
                    updateSliderUI();
                }
            });

            // ê·¸ë¦¼ ì „ì²´ ì‚­ì œ(ìë™ ì²­ì†Œ) ê°ì§€
            roomRef.child('strokes').on('child_removed', (snapshot) => {
                // ê°œë³„ ì‚­ì œëŠ” ì§€ì› ì•ˆ í•˜ë¯€ë¡œ, strokes ìì²´ê°€ nullì´ ë˜ëŠ” ê²½ìš°ë¥¼ ê°ì§€í•´ì•¼ í•¨.
                // Firebase íŠ¹ì„±ìƒ ë¶€ëª¨ ë…¸ë“œë¥¼ ê°ì‹œ
            });

            roomRef.child('strokes').on('value', snapshot => {
                if(!snapshot.exists()) {
                    // ë°ì´í„°ê°€ ì‚¬ë¼ì¡Œë‹¤ë©´ ìº”ë²„ìŠ¤ ë¹„ìš°ê¸°
                    drawHistory = [];
                    ctx.clearRect(0,0, canvas.width, canvas.height);
                    updateSliderUI();
                }
            });
        }

        // --- ê·¸ë¦¬ê¸° ë¡œì§ ---
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const cx = e.touches ? e.touches[0].clientX : e.clientX;
            const cy = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: cx - rect.left, y: cy - rect.top };
        }

        function startDrawing(e) {
            if (isReplaying || !currentRoom) return;
            isDrawing = true;
            const pos = getPos(e);
            lastX = pos.x; lastY = pos.y;
        }

        function drawProcess(e) {
            if (!isDrawing || isReplaying) return;
            if(e.target === canvas) e.preventDefault();
            const pos = getPos(e);
            
            const strokeData = {
                start: {x: lastX, y: lastY},
                end: {x: pos.x, y: pos.y},
                color: document.getElementById('colorPicker').value,
                width: document.getElementById('lineWidth').value,
                isEraser: isEraserMode,
                timestamp: firebase.database.ServerValue.TIMESTAMP
            };

            // ì„œë²„ ì „ì†¡
            roomRef.child('strokes').push(strokeData);
            lastX = pos.x; lastY = pos.y;
        }

        function stopDrawing() { isDrawing = false; }

        function drawLine(start, end, color, width, isEraser) {
            ctx.beginPath();
            ctx.moveTo(start.x, start.y);
            ctx.lineTo(end.x, end.y);
            
            if (isEraser) {
                ctx.globalCompositeOperation = 'destination-out';
                ctx.strokeStyle = 'rgba(0,0,0,1)';
            } else {
                ctx.globalCompositeOperation = 'source-over';
                ctx.strokeStyle = color;
            }
            
            ctx.lineWidth = width;
            ctx.lineCap = 'round';
            ctx.lineJoin = 'round';
            ctx.stroke();
            ctx.globalCompositeOperation = 'source-over';
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        canvas.addEventListener('mousedown', startDrawing);
        canvas.addEventListener('touchstart', startDrawing, {passive: false});
        window.addEventListener('mousemove', drawProcess);
        window.addEventListener('touchmove', drawProcess, {passive: false});
        window.addEventListener('mouseup', stopDrawing);
        window.addEventListener('touchend', stopDrawing);
        wrapper.addEventListener('mouseleave', stopDrawing);

        // íˆ´ë°” ë²„íŠ¼
        penBtn.onclick = () => { isEraserMode = false; updateToolUI(penBtn); canvas.style.cursor = 'crosshair'; };
        eraserBtn.onclick = () => { isEraserMode = true; updateToolUI(eraserBtn); canvas.style.cursor = 'default'; };
        
        function updateToolUI(activeBtn) {
            document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
            activeBtn.classList.add('active');
        }

        // --- ìœ í‹¸ë¦¬í‹° (ë¦¬ì‚¬ì´ì¦ˆ, íƒ€ì„ë¨¸ì‹ ) ---
        function resizeCanvas() {
            canvas.width = wrapper.offsetWidth;
            canvas.height = wrapper.offsetHeight;
            redrawCanvas(historySlider.value);
        }
        window.addEventListener('resize', resizeCanvas);

        function updateSliderUI() {
            const t = translations[currentLang];
            if (!isReplaying) {
                historySlider.max = drawHistory.length;
                historySlider.value = drawHistory.length;
                statusText.innerText = `${t.history}: ${drawHistory.length}`;
            }
        }

        function redrawCanvas(upto) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for(let i=0; i<upto; i++) {
                const s = drawHistory[i];
                drawLine(s.start, s.end, s.color, s.width, s.isEraser);
            }
        }

        historySlider.oninput = (e) => {
            isReplaying = true;
            const val = parseInt(e.target.value);
            redrawCanvas(val);
            const t = translations[currentLang];
            statusText.innerText = `${t.history}: ${val} / ${drawHistory.length}`;
            if(val === drawHistory.length) isReplaying = false;
        };

        playBtn.onclick = () => {
            const t = translations[currentLang];
            if(isReplaying) {
                isReplaying = false; 
                playBtn.innerHTML = t.play;
                historySlider.value = drawHistory.length; 
                redrawCanvas(drawHistory.length);
                updateSliderUI();
                return;
            }
            if(drawHistory.length === 0) return;
            
            isReplaying = true; 
            playBtn.innerHTML = t.stop;
            let frame = 0;
            
            const animate = () => {
                if(!isReplaying || frame >= drawHistory.length) {
                    isReplaying = false; 
                    playBtn.innerHTML = t.play;
                    historySlider.value = drawHistory.length; 
                    redrawCanvas(drawHistory.length);
                    updateSliderUI();
                    return;
                }
                const speed = 10;
                for(let i=0; i<speed && frame < drawHistory.length; i++) {
                    const s = drawHistory[frame++];
                    drawLine(s.start, s.end, s.color, s.width, s.isEraser);
                }
                historySlider.value = frame;
                statusText.innerText = `${t.replaying} ${frame}`;
                requestAnimationFrame(animate);
            };
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            requestAnimationFrame(animate);
        };
    </script>
</body>
</html>

